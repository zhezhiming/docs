---
title: 地理图
sidebar_position: 21
---

:::info

**地理图**（也称为**地理图表**）是各大州、国家或地区不同数据的理想可视化工具。地理图向读者展示了分布在地图各个区域的数值的热图。例如，美国地图人口密度较高的区域可以用较深的颜色显示，而人口稀少的区域则用相同色调的浅色显示。

:::

<iframe src="https://app.mtda.cloud/public/story/widget/1381f45a-ded7-44d1-8a44-31d0ef5b0a70" width="100%" height="500px" frameBorder="0" scrolling="no" allowFullScreen> </iframe>

## 地理信息

创建地理图形前需要准备所需的地理文件, 例如美国地理文件可以参考 [U.S. Atlas TopoJSON](https://github.com/topojson/us-atlas) 找到可被浏览器下载的地理文件链接.

选择图形类型为 **地理图** (GeoMap) , 点击其右侧地图按钮进行地理信息设置:

![Small Shadow](./geomap-info.png)

输入地图名称: 保持唯一.

地理文件链接: 输入地理文件的链接地址.

地理数据文件支持两种标准格式:

* [GeoJSON](https://en.wikipedia.org/wiki/GeoJSO) **默认使用**, 
* [TopoJSON](https://github.com/topojson/topojson) 选中 **是 TopoJSON 格式** 并在 Feature 对象名称输入框内输入需要使用的属性名称, 多个名称以 `,` 分隔. Feature 对象名称在文件内容 JSON 中的 `objects` 属性下找到.

地图投影: 如果需要可以指定特定的地图投影算法, 算法列表可参考 [d3-geo-projection](https://github.com/d3/d3-geo-projection).

## 等值区域图

:::info

A [Choropleth Map](https://en.wikipedia.org/wiki/Choropleth_map) displays divided geographical areas or regions that are coloured in relation to a numeric variable. It allows to study how a variable evolutes along a territory. It is a powerful and widely used data visualization technique. However, its downside is that regions with bigger sizes tend to have a bigger weight in the map interpretation, which includes a bias.

:::

### 数据映射

要在地理地图上展示数据的分布信息, 需要将数据维度与地理信息对应起来. 

主维度成员名称值与地理信息对象 Feature 中的 Properties 里的 name 属性值进行对应起来.

### 视觉映射

等值区域图通过颜色的不同来表达区域内数值的差异. 大部分情况下是使用颜色的渐变来表达数值的线性渐变.

设置等值区域颜色序列, 打开度量的更多按钮, 选择**样式**, 选择**调色板**, 选择一个颜色序列, 图形将展示为相应的颜色等值区域图. 颜色序列从左到右对应度量值的从小到大, 选择**反转**可以使颜色序列反转对应度量值的从大到小.

![Middle Shadow](./color-schemes.png)

更多关于视觉映射的详细设置可以通过开启**可视映射**属性组来设置. 例如想要消除偏离主体数值比较大的最大(或最小)值对整体颜色分布的影响导致大部分颜色过于接近, 可以通过设置可视映射的最大(或最小)值属性进行规范.

![Small Shadow](./visualMap.png)

## 图形变换

为了更好地展现数据分布, 在地理图形基础上再添加其他图形展示可以达到不同的效果. 在**图形配置**里的**图形变体**里添加图形类型, 图形组件上将出现图形类型的选择项,
点击图形选择可以切换不同的图形展示.

在图形配置开启**全局过渡动画**, 可以使图形之间的元素进行连续变换.

<iframe src="https://app.mtda.cloud/public/story/widget/afae8fea-1a17-4d37-90bc-f908ef28fd15" width="100%" height="500px" frameBorder="0" scrolling="no" allowFullScreen> </iframe>


参考:

* https://github.com/deldersveld/topojson
* https://github.com/tmcw/awesome-geojson
