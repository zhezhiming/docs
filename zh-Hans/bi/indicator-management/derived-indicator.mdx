---
title: 📈衍生指标
sidebar_position: 4
tags:
  - SQL
  - MDX
  - 公式
---

在指标管理中，**衍生指标** 是指从原始度量值计算出来的值的指标。衍生指标通常是通过对原始度量进行运算或组合得到的，它可以提供对原始指标的更深入的理解。

例如，如果有一个原始度量叫做销售额，那么可以计算出销售额增长率来作为一个衍生指标，这个指标可以帮助我们了解销售额的增长情况。

衍生指标可以使用不同的单位或运算方式如比率来衡量原始度量，例如在销售数据中，可以通过计算每个销售员的销售额与总销售额的比率来衡量销售员的业绩，这个指标就是一个衍生指标。

## 衍生指标

一个指标设置为衍生指标后就可以通过 **计算公式** 和 **聚合类型** 两个属性表达衍生指标内容.

计算公式可以直接在输入框中输入, 也可以使用弹出公式编辑窗口进行编写.

## SQL 模型的计算公式

基于 SQL 多维模型的指标计算公式支持使用 **Measures** 度量进行计算, 可以在计算公式编辑窗口中打开右侧模型实体类型列表, 将度量拖至编辑器中:

![Middle Shadow](./sql-formula.png)

**聚合类型** 决定了指标计算公式中的度量是计算后再聚合还是计算前进行聚合. 如果衍生指标设置了聚合类型, 那么公式计算后再进行聚合, 如果为设置聚合类型, 则计算公式中的度量使用其自身的聚合类型先进行聚合再进行公式计算.

如上图计算公式, 如果衍生指标设置了聚合类型为 **SUM** 那么最终运行时生成的 SQL 片段为

```sql
SUM("sales_fact"."Sales Amount" - "sales_fact"."Cost")
```

如果此衍生指标未设置聚合类型, 那么生成的 SQL 片段为

```sql
SUM("sales_fact"."Sales Amount") - SUM("sales_fact"."Cost")
```

这种情况在计算比率的情况有实际用处.

## MDX 模型的计算公式

基于 MDX 模型的衍生指标可以使用 MDX 语言进行编写指标的计算公式, 由于 MDX 语言可以实现复杂的数据查询和分析, 所以基于 MDX 计算公式的衍生指标可以实现复杂的指标计算.

举例来说, 如果创建一个 *美国区销售利润增长率* 指标, 在指标的限定条件里加入 *美国区* 的切片器, 然后编写 MDX 计算公式如下:

`( Measures.[Profit] - CoalesceEmpty( (Measures.[Profit], [Time].PrevMember), Measures.[Profit] ) ) / CoalesceEmpty( (Measures.[Profit], [Time].PrevMember), Measures.[Profit] )`

![衍生指标计算公式](/public/img/indicator/indicator-formula.png)

## 总结

衍生指标在数据分析和管理中非常重要，因为它们可以帮助我们更好地了解数据并进行决策。 例如衍生指标可以用来监控业务运营情况，如销售额增长率、客户满意度等，也可以用来评估员工绩效，如销售额与销售额目标的差距。
